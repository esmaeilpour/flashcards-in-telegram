{"version":3,"sources":["webpack:///webpack/bootstrap a8dc3099a403867a718e","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///./src/data/strings.js","webpack:///./src/mongo.js","webpack:///./src/configs.js","webpack:///./src/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"tgux\"","webpack:///external \"mongodb\"","webpack:///./src/cache.js","webpack:///./src/activities.js","webpack:///./src/activities/start.js","webpack:///./src/activities/tags.js","webpack:///./src/activities/learn.js","webpack:///./src/activities/review.js"],"names":["back","learn","review","uri","mongo","MongoClient","connect","ObjectId","process","env","MONGO_URI","telegram","token","TELEGRAM_TOKEN","cardGroups","configs","db","cache","prototype","storage","bot","polling","setCacheHandler","activity","main","data","key","value","Promise","update","_id","$set","JSON","stringify","upsert","resolve","find","next","err","doc","parse","collection","createActivity","on","msg","opts","reply_markup","keyboard","keyboards","resize_keyboard","sendMessage","chat","id","strings","foldm","r","j","reduce","a","b","i","g","concat","slice","tags","history","chat_id","toArray","tag","title","map","unshift","reason","text","indexOf","forward","params","back_to","insertOne","more","cards","card","content","message","Object","assign","p","group","speed","easy","hard","callback_data","Buffer","toString","filter","reply_to_message_id","message_id","inline_keyboard","cq","from","split","action","card_id","findOne","updateOne","editMessageReplyMarkup","cardButtons","nextCard","sort","next_study","limit","hideMore","mainButtons","get","PendingUpdate","type","caption","save","set","tag_title","query","$nin","cursor","count","forEach","photo","sendPhoto","length","file_id","video","sendVideo","audio","sendAudio","voice","sendVoice","document","sendDocument","nextGroup","Math","min","delay","Date","$inc","max","remove","answerCallbackQuery","editMessageText","editMessageCaption"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a8dc3099a403867a718e","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","export default {\n\tback: 'Back',\n\tlearn: 'Learn',\n\treview: 'Review',\n}\n\n\n// WEBPACK FOOTER //\n// ./src/data/strings.js","import mongo from 'mongodb'\n\nexport default async function(uri) {\n  return await mongo.MongoClient.connect(uri)\n}\n\nexport const ObjectId = mongo.ObjectId\n\n\n// WEBPACK FOOTER //\n// ./src/mongo.js","export default {\n  mongo: {\n    uri: process.env.MONGO_URI,\n  },\n\n  telegram: {\n    token: process.env.TELEGRAM_TOKEN,\n  },\n\n  cardGroups: {\n     1: 86400,\n     2: 3 * 86400,\n     3: 5 * 86400,\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/configs.js","import configs from './configs'\nimport Bot from 'tgux'\nimport mongo, {ObjectId} from './mongo'\nimport cache from './cache'\nimport activities from './activities'\n\nasync function main () {\n\tvar db = await mongo(configs.mongo.uri)\n\n\tcache.prototype.storage = db\n\n\tvar bot = new Bot(configs.telegram.token, {polling: true})\n\n\tbot.setCacheHandler(cache)\n\n\tfor (let activity of activities) {\n\t\tactivity(bot, db)\n\t}\n}\n\nmain()\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"tgux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tgux\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 8\n// module chunks = 0","export default class {\n\tconstructor() {\n\t\tthis.data = {}\n\t}\n\n\tset(key, value) {\n\t\tvar db = this.db\n\t\treturn new Promise(resolve => {\n\t\t\tdb.cache.update({_id: key}, {$set: {data: JSON.stringify(value)}}, {upsert: true})\n\t\t\tresolve(true)\n\t\t})\n\t}\n\n\tget(key) {\n\t\tvar db = this.db\n\t\treturn new Promise(resolve => {\n\t\t\tdb.cache.find({_id: key}).next((err, doc) => {\n\t\t\t\tif (doc) {\n\t\t\t\t\tresolve(JSON.parse(doc.data))\n\t\t\t\t} else {\n\t\t\t\t\treturn resolve(false)\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\tget db() {\n\t\treturn {\n\t\t\tcache: this.storage.collection('cache')\n\t\t}\n\t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cache.js","import start from './activities/start.js'\nimport tags from './activities/tags.js'\nimport learn from './activities/learn.js'\nimport review from './activities/review.js'\n\nexport default [\n\tstart,\n\ttags,\n\tlearn,\n\treview,\n]\n\n\n// WEBPACK FOOTER //\n// ./src/activities.js","import strings from '../data/strings'\n\nexport default function(bot, db) {\n\tbot.createActivity('start', activity => {\n\n\t\tactivity.on('home', async msg => {\n\t\t\tlet opts = {\n\t\t\t\treply_markup: JSON.stringify({\n\t\t\t\t\tkeyboard: activity.keyboards,\n\t\t\t\t\tresize_keyboard: true,\n\t\t\t\t})\n\t\t    }\n\n\t\t\tbot.sendMessage(msg.chat.id, 'start', opts)\n\t\t})\n\n\t\tactivity.on(strings.learn, ['learn', 'home'])\n\t\tactivity.on(strings.review, ['review', 'home'])\n\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./src/activities/start.js","import strings from '../data/strings'\n\nconst foldm = (r,j) => r.reduce((a,b,i,g) => !(i % j) ? a.concat([g.slice(i,i+j)]) : a, [])\n\nexport default function(bot, db) {\n\tdb.tags = db.collection('tags')\n\n\tbot.createActivity('tags', activity => {\n\n\t\tactivity.on('home', async (msg, history) => {\n\t\t\tvar tags = (await db.tags.find({chat_id: msg.chat.id}).toArray()).map(tag => tag.title)\n\n\t\t\ttags.unshift('word')\n\n\t\t\tif (history.reason == 'normal') {\n\t\t\t\tlet tag = msg.text\n\t\t\t\tif (tags.indexOf(tag) == -1) {\n\t\t\t\t\treturn history.forward(['home'], history.params)\n\t\t\t\t}\n\t\t\t\treturn history.forward([history.params.back_to, 'home'], {tag})\n\t\t\t}\n\n\t\t\tlet opts = {\n\t\t\t\treply_markup: JSON.stringify({\n\t\t\t\t\tkeyboard: [...foldm(tags, 2), activity.keyboards[0]],\n\t\t\t\t\tresize_keyboard: true,\n\t\t\t\t})\n\t\t    }\n\t\t\tbot.sendMessage(msg.chat.id, 'tag', opts)\n\t\t})\n\n\t\tactivity.on('back_here', (msg, history) => {\n\t\t\treturn history.forward(['tags', 'home'], {tag: null})\n\t\t})\n\n\t\tactivity.on('other_tag', (msg, history) => {\n\t\t\treturn history.forward([history.params.back_to, 'home'], {tag: 'other'})\n\t\t})\n\n\t\tactivity.on('other', ['other_tag'])\n\t\tactivity.on('new', ['tags_new', 'home'])\n\t\tactivity.on(strings.back, ['start', 'home'])\n\t})\n\n\tbot.createActivity('tags_new', activity => {\n\n\t\tactivity.on('home', async (msg, history) => {\n\t\t\tif (history.reason == 'normal') {\n\t\t\t\treturn history.forward(['tags_new_more', 'home'], {title: msg.text})\n\t\t\t}\n\n\t\t\tlet opts = {\n\t\t\t\treply_markup: JSON.stringify({\n\t\t\t\t\tkeyboard: activity.keyboards,\n\t\t\t\t\tresize_keyboard: true,\n\t\t\t\t})\n\t\t    }\n\t\t\tbot.sendMessage(msg.chat.id, 'title?', opts)\n\t\t})\n\n\t\tactivity.on(strings.back, ['tags', 'home'])\n\t})\n\n\tbot.createActivity('tags_new_more', activity => {\n\n\t\tactivity.on('home', async (msg, history) => {\n\t\t\tif (history.reason == 'normal') {\n\t\t\t\tawait db.tags.insertOne({\n\t\t\t\t\tchat_id: msg.chat.id,\n\t\t\t\t\ttitle: history.params.title,\n\t\t\t\t\tmore: msg.text == 'yes',\n\t\t\t\t})\n\t\t\t\treturn history.forward(['start', 'home'])\n\t\t\t}\n\n\t\t\tlet opts = {\n\t\t\t\treply_markup: JSON.stringify({\n\t\t\t\t\tkeyboard: [['yes', 'no']],\n\t\t\t\t\tresize_keyboard: true,\n\t\t\t\t})\n\t\t    }\n\t\t\tbot.sendMessage(msg.chat.id, 'more?', opts)\n\t\t})\n\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./src/activities/tags.js","import strings from '../data/strings'\nimport {ObjectId} from '../mongo'\n\nconst foldm = (r,j) => r.reduce((a,b,i,g) => !(i % j) ? a.concat([g.slice(i,i+j)]) : a, [])\n\nexport default function(bot, db) {\n\tdb.cards = db.collection('cards')\n\tdb.tags = db.collection('tags')\n\n\tbot.createActivity('learn', activity => {\n\n\t\tactivity.on('home', async (msg, history) => {\n\n\t\t\tif (history.reason == 'normal') {\n\n\t\t\t\tlet card = {\n\t\t\t\t\tchat_id: msg.chat.id,\n\t\t\t\t\ttag: 'word',\n\t\t\t\t\tcontent: msg.text,\n\t\t\t\t\tmessage: Object.assign({}, ...['text', 'photo', 'audio', 'voice', 'video', 'document', 'caption'].map(p => msg[p] && {[p]: msg[p]})),\n\t\t\t\t\tgroup: 1,\n\t\t\t\t\tspeed: 1,\n\t\t\t\t\teasy: 0,\n\t\t\t\t\thard: 0,\n\t\t\t\t\treview: 1,\n\t\t\t\t}\n\t\t\t\tawait db.cards.insertOne(card)\n\n\t\t\t\tvar tags = (await db.tags.find({chat_id: msg.chat.id}).toArray()).filter(tag => tag.title != 'word').map(tag => {\n\t\t\t\t\treturn {text: tag.title, callback_data: new Buffer(`newcard_tag:${card._id}:${tag.title}`).toString('base64')}\n\t\t\t\t})\n\n\t\t\t\tlet opts = {\n\t\t\t\t\treply_to_message_id: msg.message_id,\n\t\t\t\t\treply_markup: {\n\t\t\t\t\t\tinline_keyboard: foldm(tags, 2)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn bot.sendMessage(msg.chat.id, 'saved', opts)\n\t\t\t}\n\n\t\t\tlet opts = {\n\t\t\t\treply_markup: {\n\t\t\t\t\tkeyboard: [['back']],\n\t\t\t\t\tresize_keyboard: true,\n\t\t\t\t}\n\t\t    }\n\n\t\t\tbot.sendMessage(msg.chat.id, 'learn', opts)\n\t\t})\n\n\t\tactivity.on('back', ['start', 'home'])\n\t})\n\n\tbot.on('callback_query', async cq => {\n\t\tlet [action, card_id, ...params] = Buffer.from(cq.data, 'base64').toString().split(':')\n\n\t\tlet card = await db.cards.findOne(ObjectId(card_id))\n\n\t\tswitch(action) {\n\t\t\tcase 'newcard_tag': {\n\t\t\t\tlet [tag] = params\n\n\t\t\t\tif (tag != '_cancel_') {\n\t\t\t\t\tawait db.cards.updateOne({_id: card._id}, {$set: {tag}})\n\t\t\t\t}\n\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t}\n\t\t\t\tawait bot.editMessageReplyMarkup(tag != '_cancel_' ? null : {inline_keyboard: cardButtons(card._id)}, opts)\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./src/activities/learn.js","import strings from '../data/strings'\nimport {ObjectId} from '../mongo'\nimport configs from '../configs'\n\nconst foldm = (r,j) => r.reduce((a,b,i,g) => !(i % j) ? a.concat([g.slice(i,i+j)]) : a, [])\n\nexport default function(bot, db) {\n\tdb.cards = db.collection('cards')\n\tdb.tags = db.collection('tags')\n\n\tvar nextCard = () => {\n\t\treturn db.cards.find().sort({next_study: 1}).limit(1).next()\n\t}\n\n\tvar cardButtons = (id, hideMore) => {\n\t\tlet mainButtons = [\n\t\t\t{text: 'very easy', callback_data: new Buffer(`very_easy:${id}`).toString('base64')},\n\t\t\t{text: 'easy', callback_data: new Buffer(`easy:${id}`).toString('base64')},\n\t\t\t{text: 'hard', callback_data: new Buffer(`hard:${id}`).toString('base64')},\n\t\t\t{text: 'very hard', callback_data: new Buffer(`very_hard:${id}`).toString('base64')},\n\t\t]\n\t\treturn hideMore ? [\n\t\t\t[\n\t\t\t\t{text: 'append', callback_data: new Buffer(`append:${id}`).toString('base64')},\n\t\t\t\t{text: 'replace', callback_data: new Buffer(`replace:${id}`).toString('base64')},\n\t\t\t\t{text: 'tag', callback_data: new Buffer(`tag:${id}`).toString('base64')},\n\t\t\t\t{text: 'delete', callback_data: new Buffer(`delete:${id}`).toString('base64')},\n\t\t\t],\n\t\t\t[\n\t\t\t\t{text: 'back', callback_data: new Buffer(`back:${id}`).toString('base64')},\n\t\t\t],\n\t\t] : [\n\t\t\tmainButtons,\n\t\t\t[{text: 'more', callback_data: new Buffer(`more:${id}`).toString('base64')}]\n\t\t]\n\t}\n\n\tbot.createActivity('review', activity => {\n\n\t\tactivity.on('home', async (msg, history) => {\n\t\t\tif (!history.params.tag) {\n\t\t\t\treturn history.forward(['tags', 'home'], {back_to: 'review'})\n\t\t\t}\n\n\t\t\tif (history.reason == 'normal') {\n\t\t\t\treturn bot.sendMessage(msg.chat.id, 'ok')\n\t\t\t}\n\n\t\t\tlet opts = {\n\t\t\t\treply_markup: {\n\t\t\t\t\tkeyboard: [['continue', 'back']],\n\t\t\t\t\tresize_keyboard: true,\n\t\t\t\t}\n\t\t    }\n\n\t\t\tawait bot.sendMessage(msg.chat.id, 'review', opts)\n\n\t\t\thistory.forward(['continue_review'], history.params)\n\t\t})\n\n\n\t\tactivity.on('continue_review', async (msg, history) => {\n\t\t\tif (msg.text == 'back') {\n\t\t\t\treturn history.forward(['tags'])\n\t\t\t}\n\n\t\t\tif (history.reason == 'normal' && msg.text != 'continue') {\n\t\t\t\tlet PendingUpdate = await bot.cache.get('PendingUpdate' + msg.chat.id)\n\n\t\t\t\tif (PendingUpdate) {\n\t\t\t\t\tlet card = await db.cards.findOne({_id: ObjectId(PendingUpdate.id)})\n\t\t\t\t\tif (PendingUpdate.type == 'append') {\n\t\t\t\t\t\tif (card.message.text) {\n\t\t\t\t\t\t\tcard.message.text = card.message.text + \"\\n\" + msg.text\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcard.message.caption = (card.message.caption || '') + \"\\n\" + msg.text\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (PendingUpdate.type == 'replace') {\n\t\t\t\t\t\tcard.message = Object.assign({}, ...['text', 'photo', 'audio', 'voice', 'video', 'document', 'caption'].map(p => msg[p] && {[p]: msg[p]}))\n\t\t\t\t\t}\n\t\t\t\t\tdb.cards.save(card)\n\n\t\t\t\t\treturn await bot.sendMessage(msg.chat.id, 'ok', {reply_to_message_id: PendingUpdate.message_id})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait bot.cache.set('PendingUpdate' + msg.chat.id, null)\n\t\t\t\n\n\t\t\tlet tag_title = history.params.tag\n\t\t\tlet query = {tag: tag_title}\n\n\t\t\tif (tag_title == 'other') {\n\t\t\t\tvar tags = (await db.tags.find({chat_id: msg.chat.id}).toArray()).map(tag => tag.title)\n\t\t\t\tquery = {tag: {$nin: ['word', ...tags]}}\n\t\t\t}\n\n\t\t\tlet tag = await db.tags.findOne({chat_id: msg.chat.id, title: tag_title})\n\t\t\tlet cursor = db.cards.find(query).sort({next_study: 1}).limit(10)\n\n\t\t\tif (!(await cursor.count())) {\n\t\t\t\treturn bot.sendMessage(msg.chat.id, 'empty')\n\t\t\t}\n\n\t\t\tcursor.forEach(card => {\n\t\t\t\tlet message = card.message\n\t\t\t\tlet hideMore = (tag_title == 'word' || (tag_title != 'other' && tag.more))\n\t\t\t\tlet opts = {\n\t\t\t\t\treply_markup: {\n\t\t\t\t\t\tinline_keyboard: cardButtons(card._id),\n\t\t\t\t\t\tresize_keyboard: false,\n\t\t\t\t\t},\n\t\t\t\t\tcaption: hideMore ? '' : message.caption,\n\t\t\t\t}\n\t\t\t\tif (message.text) {\n\t\t\t\t\treturn bot.sendMessage(msg.chat.id, hideMore ? message.text.split(\"\\n\")[0] : message.text, opts)\n\t\t\t\t}\n\t\t\t\telse if (message.photo) {\n\t\t\t\t\treturn bot.sendPhoto(msg.chat.id, message.photo[message.photo.length - 1].file_id, opts)\n\t\t\t\t}\n\t\t\t\telse if (message.video) {\n\t\t\t\t\treturn bot.sendVideo(msg.chat.id, message.video.file_id, opts)\n\t\t\t\t}\n\t\t\t\telse if (message.audio) {\n\t\t\t\t\treturn bot.sendAudio(msg.chat.id, message.audio.file_id, opts)\n\t\t        }\n\t\t        else if (message.voice) {\n\t\t\t\t\treturn bot.sendVoice(msg.chat.id, message.voice.file_id, opts)\n\t\t        }\n\t\t        else if (message.document) {\n\t\t\t\t\treturn bot.sendDocument(msg.chat.id, message.document.file_id, opts)\n\t\t        }\n\t\t\t\t\n\t\t\t})\n\t\t})\n\n\t\tactivity.on('tags', async (msg, history) => {\n\t\t\tawait bot.cache.set('PendingUpdate' + msg.chat.id, null)\n\t\t\thistory.forward(['tags', 'home'], {back_to: 'review', tag: null})\n\t\t})\n\n\t\tactivity.on('continue', ['review', 'home'])\n\t\tactivity.on('back', ['tags'])\n\t})\n\n\tbot.on('callback_query', async cq => {\n\t\tlet [action, card_id, ...params] = Buffer.from(cq.data, 'base64').toString().split(':')\n\n\t\tlet card = await db.cards.findOne(ObjectId(card_id))\n\t\tlet review = async () => {\n\t\t\tlet opts = {\n\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t}\n\t\t\tawait bot.editMessageReplyMarkup({\n\t\t\t\tinline_keyboard: [\n\t\t\t\t\t[\n\t\t\t\t\t\t{text: 'undo', callback_data: new Buffer(`undo:${card._id}`).toString('base64')},\n\t\t\t\t\t]\n\t\t\t\t]\n\t\t\t}, opts)\n\t\t}\n\n\t\tswitch(action) {\n\t\t\tcase 'very_easy': {\n\t\t\t\tlet nextGroup = Math.min(card.group + 1, 3)\n\t\t\t\tlet delay = configs.cardGroups[nextGroup] * 2\n\n\t\t\t\tawait db.cards.updateOne({_id: card._id}, {$set: {next_study: +new Date + delay}, $inc: {easy: 1}})\n\n\t\t\t\tawait review()\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'easy': {\n\t\t\t\tlet nextGroup = Math.min(card.group + 1, 3)\n\t\t\t\tlet delay = configs.cardGroups[nextGroup]\n\n\t\t\t\tawait db.cards.updateOne({_id: card._id}, {$set: {next_study: +new Date + delay}, $inc: {easy: 1}})\n\n\t\t\t\tawait review()\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'hard': {\n\t\t\t\tlet nextGroup = Math.max(card.group - 1, 1)\n\t\t\t\tlet delay = configs.cardGroups[nextGroup]\n\n\t\t\t\tawait db.cards.updateOne({_id: card._id}, {$set: {next_study: +new Date + delay}, $inc: {hard: 1}})\n\n\t\t\t\tawait review()\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'very_hard': {\n\t\t\t\tlet nextGroup = Math.max(card.group - 1, 1)\n\t\t\t\tlet delay = configs.cardGroups[nextGroup] / 2\n\n\t\t\t\tawait db.cards.updateOne({_id: card._id}, {$set: {next_study: +new Date + delay}, $inc: {hard: 1}})\n\n\t\t\t\tawait review()\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'back': {\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t}\n\t\t\t\tawait bot.editMessageReplyMarkup({\n\t\t\t\t\tinline_keyboard: cardButtons(card._id)\n\t\t\t\t}, opts)\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'undo': {\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t}\n\t\t\t\tawait bot.editMessageReplyMarkup({\n\t\t\t\t\tinline_keyboard: cardButtons(card._id)\n\t\t\t\t}, opts)\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'tag': {\n\t\t\t\tvar tags = (await db.tags.find({chat_id: cq.message.chat.id}).toArray()).map(tag => {\n\t\t\t\t\treturn {text: tag.title, callback_data: new Buffer(`tag_change:${card._id}:${tag.title}`).toString('base64')}\n\t\t\t\t})\n\n\t\t\t\ttags = [\n\t\t\t\t\t{text: 'word', callback_data: new Buffer(`tag_change:${card._id}:word`).toString('base64')},\n\t\t\t\t\t...tags,\n\t\t\t\t]\n\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t}\n\t\t\t\tawait bot.editMessageReplyMarkup({\n\t\t\t\t\tinline_keyboard: [...foldm(tags, 2), [{text: 'cancel', callback_data: new Buffer(`tag_change:${card._id}:_cancel_`).toString('base64')}]],\n\t\t\t\t}, opts)\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'tag_change': {\n\t\t\t\tlet [tag] = params\n\n\t\t\t\tif (tag != '_cancel_') {\n\t\t\t\t\tawait db.cards.updateOne({_id: card._id}, {$set: {tag}})\n\t\t\t\t}\n\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t}\n\t\t\t\tawait bot.editMessageReplyMarkup(tag != '_cancel_' ? null : {inline_keyboard: cardButtons(card._id)}, opts)\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'delete': {\n\t\t\t\tawait db.cards.remove({_id: card._id})\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t}\n\t\t\t\tawait bot.editMessageReplyMarkup(null, opts)\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'append': {\n\t\t\t\tawait bot.cache.set('PendingUpdate' + cq.message.chat.id, {type: 'append', id: card._id, message_id: cq.message.message_id})\n\t\t\t\tbot.answerCallbackQuery(cq.id, 'send more')\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'replace': {\n\t\t\t\tawait bot.cache.set('PendingUpdate' + cq.message.chat.id, {type: 'replace', id: card._id, message_id: cq.message.message_id})\n\t\t\t\tbot.answerCallbackQuery(cq.id, 'send new')\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tcase 'more': {\n\t\t\t\tlet opts = {\n\t\t\t\t\tchat_id: cq.message.chat.id,\n\t\t\t\t\tmessage_id: cq.message.message_id,\n\t\t\t\t\treply_markup: {\n\t\t\t\t\t\tinline_keyboard: cardButtons(card._id, true)\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t\tif (card.message.text) {\n\t\t\t\t\tawait bot.editMessageText(card.message.text, opts)\n\t\t\t\t} else {\n\t\t\t\t\tawait bot.editMessageCaption(card.message.caption, opts)\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./src/activities/review.js"],"sourceRoot":""}